import React, { useState } from 'react';

const FashionProgramTimeline = () => {
  // Track which year view is active
  const [activeYear, setActiveYear] = useState('year1');

  // Timeline data structure
  const timelineData = {
    year1: {
      title: "Year 1: Non-weighted",
      description: "Allowing for experimentation and exploration without high stakes.",
      weeks: 30,
      items: [
        { id: 'induction', name: 'Induction', start: 1, duration: 2, type: 'activity' },
        { id: 'project1', name: 'Project One (FN4004)', start: 3, duration: 9, type: 'activity' },
        { id: 'formative1', name: 'Formative Feedback (FN4004)', start: 9, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Mid-project feedback session focusing on your initial design concepts and research direction." },
        { id: 'summative1', name: 'Summative Assessment (FN4004)', start: 12, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final assessment of your first project work including research, development, and outcomes." },
        { id: 'enrichment1', name: 'TB1 Enrichment Week', start: 8, duration: 1, type: 'break' },
        { id: 'project2', name: 'Project Two (FN4004)', start: 12, duration: 10, type: 'activity' },
        { id: 'formative2', name: 'Formative Feedback (FN4004)', start: 20, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Development feedback for your second project to help refine your direction." },
        { id: 'winterBreak', name: 'Winter Break', start: 22, duration: 4, type: 'break' },
        { id: 'toile', name: 'Toile Development (FN4005)', start: 26, duration: 8, type: 'activity' },
        { id: 'project3', name: 'Project Three (FN4004)', start: 26, duration: 12, type: 'activity' },
        { id: 'formative3', name: 'Formative Feedback (FN4005)', start: 32, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Technical feedback on your toile development and construction techniques." },
        { id: 'enrichment2', name: 'TB2 Enrichment Week', start: 33, duration: 1, type: 'break' },
        { id: 'portfolio', name: 'Portfolio Development (FN4005)', start: 34, duration: 4, type: 'activity' },
        { id: 'summative2', name: 'Summative Submission (FN4005)', start: 38, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final portfolio assessment including technical work and completed projects." },
        { id: 'historical', name: 'Historical Themes Research (HA4104)', start: 3, duration: 13, type: 'activity' },
        { id: 'essayPlanning', name: 'Essay Planning (HA4104)', start: 16, duration: 6, type: 'activity' },
        { id: 'essayWriting', name: 'Essay Writing Period (HA4104)', start: 26, duration: 10, type: 'activity' },
        { id: 'chsSubmission', name: 'CHS Submission (HA4104)', start: 36, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final submission of your written Cultural & Historical Studies essay." },
      ]
    },
    year2: {
      title: "Year 2: 20% weighted",
      description: "Contributes 20% to your final mark, reflecting the adoption of Professional Practice.",
      weeks: 30,
      items: [
        { id: 'induction2', name: 'Induction', start: 1, duration: 2, type: 'activity' },
        { id: 'project1_y2', name: 'Project One (FN5001)', start: 3, duration: 9, type: 'activity' },
        { id: 'formative1_y2', name: 'Formative Feedback (FN5001)', start: 9, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Mid-project feedback focusing on your design development and concept research." },
        { id: 'summative1_y2', name: 'Project Submission (FN5001)', start: 12, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Assessment of your project outcomes, contributing to your 20% Year 2 weighting." },
        { id: 'enrichment1_y2', name: 'TB1 Enrichment Week', start: 8, duration: 1, type: 'break' },
        { id: 'designTutorials', name: 'Design Process Tutorials (FN5001)', start: 12, duration: 10, type: 'activity' },
        { id: 'majorProject1', name: 'Major Project Phase 1 (FN5001)', start: 12, duration: 10, type: 'activity' },
        { id: 'formativeReview', name: 'Formative Review (FN5001)', start: 20, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Comprehensive review of your work to date with industry feedback." },
        { id: 'winterBreak_y2', name: 'Winter Break', start: 22, duration: 4, type: 'break' },
        { id: 'productDev', name: 'Product Development (FN5003)', start: 26, duration: 8, type: 'activity' },
        { id: 'iconsMuses', name: 'Icons & Muses (FN5001)', start: 26, duration: 12, type: 'activity' },
        { id: 'midPoint', name: 'Mid-Point Formative (FN5003)', start: 32, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Technical and creative feedback on your product development work." },
        { id: 'enrichment2_y2', name: 'TB2 Enrichment Week', start: 33, duration: 1, type: 'break' },
        { id: 'portfolioDev_y2', name: 'Portfolio Development (FN5003)', start: 34, duration: 4, type: 'activity' },
        { id: 'finalSubmission', name: 'Final Project Submission (FN5003)', start: 38, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final assessment of your Year 2 projects and portfolio." },
        { id: 'historical_y2', name: 'Historical Themes Research (HA5107)', start: 3, duration: 13, type: 'activity' },
        { id: 'essayPlanning_y2', name: 'Essay Planning (HA5107)', start: 16, duration: 6, type: 'activity' },
        { id: 'essayWriting_y2', name: 'Essay Writing Period (HA5107)', start: 26, duration: 10, type: 'activity' },
        { id: 'chsSubmission_y2', name: 'CHS Submission (HA5107)', start: 36, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final submission of your Year 2 Cultural & Historical Studies essay." },
      ]
    },
    year3: {
      title: "Year 3: 80% weighted",
      description: "Carries the majority of the weight at 80%, emphasising the importance of your final year work.",
      weeks: 30,
      items: [
        { id: 'induction3', name: 'Induction', start: 1, duration: 2, type: 'activity' },
        { id: 'project1_y3', name: 'Project One (FN6001)', start: 3, duration: 9, type: 'activity' },
        { id: 'formative1_y3', name: 'Formative Feedback (FN6001)', start: 9, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Critical feedback on your final year project direction and concept development." },
        { id: 'summative1_y3', name: 'Project Submission (FN6001)', start: 12, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Assessment of your first final-year project, contributing to your 80% weighting." },
        { id: 'enrichment1_y3', name: 'TB1 Enrichment Week', start: 8, duration: 1, type: 'break' },
        { id: 'designTutorials_y3', name: 'Design Process Tutorials (FN6001)', start: 12, duration: 10, type: 'activity' },
        { id: 'majorProject1_y3', name: 'Major Project Phase 1 (FN6001)', start: 12, duration: 10, type: 'activity' },
        { id: 'formativeReview_y3', name: 'Formative Review (FN6001)', start: 20, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Industry-facing review of your collection development and professional portfolio." },
        { id: 'winterBreak_y3', name: 'Winter Break', start: 22, duration: 4, type: 'break' },
        { id: 'productDev_y3', name: 'Product Development (FN6004)', start: 26, duration: 8, type: 'activity' },
        { id: 'iconsMuses_y3', name: 'Icons & Muses (FN6004)', start: 26, duration: 12, type: 'activity' },
        { id: 'midPoint_y3', name: 'Mid-Point Formative (FN6004)', start: 32, duration: 0, type: 'formative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final development feedback before your summative assessment." },
        { id: 'enrichment2_y3', name: 'TB2 Enrichment Week', start: 33, duration: 1, type: 'break' },
        { id: 'portfolioDev_y3', name: 'Portfolio Development (FN6004)', start: 34, duration: 4, type: 'activity' },
        { id: 'finalSubmission_y3', name: 'Final Project Submission (FN6004)', start: 38, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final major project submission that forms the largest part of your degree classification." },
        { id: 'historical_y3', name: 'Historical Themes Research (HA6101)', start: 3, duration: 13, type: 'activity' },
        { id: 'essayPlanning_y3', name: 'Essay Planning (HA6101)', start: 16, duration: 6, type: 'activity' },
        { id: 'essayWriting_y3', name: 'Essay Writing Period (HA6101)', start: 26, duration: 10, type: 'activity' },
        { id: 'chsSubmission_y3', name: 'CHS Submission (HA6101)', start: 36, duration: 0, type: 'summative', 
          link: "https://canvas.kingston.ac.uk/courses/32501/pages/placeholder",
          details: "Final submission of your Year 3 Cultural & Historical Studies dissertation." },
      ]
    }
  };

  // State to track which assessment is showing details
  const [activeDetail, setActiveDetail] = useState(null);

  // Calculate positions for the Gantt chart
  const calculatePosition = (start, duration, totalWeeks) => {
    const leftPosition = (start / totalWeeks) * 100; // As percentage of total width
    const widthPercentage = duration > 0 ? (duration / totalWeeks) * 100 : 2; // Minimum width for milestones
    return {
      left: `${leftPosition}%`,
      width: `${widthPercentage}%`
    };
  };

  // Handle clicking on year tabs
  const handleYearClick = (year) => {
    setActiveYear(year);
    setActiveDetail(null); // Reset detail view when changing years
  };

  // Handle clicking on assessment milestones
  const handleDetailClick = (itemId) => {
    if (activeDetail === itemId) {
      setActiveDetail(null);
    } else {
      setActiveDetail(itemId);
    }
  };

  // Render timeline items
  const renderTimelineItems = () => {
    const activeData = timelineData[activeYear];
    const totalWeeks = activeData.weeks;
    
    return activeData.items.map((item, index) => {
      const position = calculatePosition(item.start, item.duration, totalWeeks);
      let itemClass = 'absolute h-8 rounded border flex items-center justify-start overflow-hidden text-sm';
      
      // Apply styling based on item type
      if (item.type === 'formative') {
        itemClass += ' bg-yellow-400 border-yellow-600 font-bold text-center justify-center cursor-pointer';
      } else if (item.type === 'summative') {
        itemClass += ' bg-red-500 text-white border-red-700 font-bold text-center justify-center cursor-pointer';
      } else if (item.type === 'break') {
        itemClass += ' bg-blue-100 border-blue-300 italic';
      } else {
        itemClass += ' bg-indigo-200 border-indigo-400';
      }
      
      // For milestone items (zero duration)
      if (item.duration === 0) {
        itemClass += ' h-6 w-6 rounded-full z-10 -ml-3';
      }

      return (
        <div key={item.id} className="relative mb-4 h-10">
          <div 
            className={itemClass}
            style={position}
            onClick={() => (item.type === 'formative' || item.type === 'summative') ? handleDetailClick(item.id) : null}
          >
            {item.duration > 0 ? (
              <span className="px-2 truncate">{item.name}</span>
            ) : (
              <span className="sr-only">{item.name}</span>
            )}
          </div>
          
          {/* Label for items */}
          <div className="absolute -mt-6 text-xs" style={{left: position.left}}>
            {item.duration === 0 && (
              <span className="whitespace-nowrap">{item.name}</span>
            )}
          </div>
        </div>
      );
    });
  };

  // Render week markers
  const renderWeekMarkers = () => {
    const totalWeeks = timelineData[activeYear].weeks;
    const markers = [];
    
    for (let i = 0; i <= totalWeeks; i += 5) {
      const position = (i / totalWeeks) * 100;
      markers.push(
        <div key={`week-${i}`} className="absolute h-full" style={{left: `${position}%`}}>
          <div className="h-full border-l border-gray-300"></div>
          <div className="text-xs text-gray-500 mt-1">Week {i}</div>
        </div>
      );
    }
    
    return (
      <div className="relative h-8 mb-6 mt-4">
        {markers}
      </div>
    );
  };

  // Render the teaching block labels
  const renderTeachingBlocks = () => {
    return (
      <div className="relative h-8 mb-4">
        <div className="absolute left-0 w-5/12 bg-yellow-50 h-6 flex items-center justify-center border border-yellow-200 text-sm">
          Teaching Block 1
        </div>
        <div className="absolute left-5/12 w-5/12 bg-yellow-50 h-6 flex items-center justify-center border border-yellow-200 text-sm">
          Teaching Block 2
        </div>
      </div>
    );
  };

  return (
    <div className="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow">
      <h1 className="text-2xl font-bold text-center mb-6">BA (Hons) Fashion Program Timeline</h1>
      
      <div className="text-center mb-6">
        <p className="mb-2">This timeline visualizes your feedback and assessment journey over the duration of the BA (Hons) Fashion Program.</p>
        <p>It demonstrates how assessment weighting contributes to your final degree classification.</p>
      </div>
      
      {/* Year selection tabs */}
      <div className="flex mb-6 border-b">
        <button 
          onClick={() => handleYearClick('year1')}
          className={`flex-1 p-3 font-semibold border-2 ${activeYear === 'year1' 
            ? 'bg-gray-100 border-gray-400' 
            : 'bg-white border-gray-200 hover:bg-gray-50'}`}
        >
          Year 1: Non-weighted
        </button>
        <button 
          onClick={() => handleYearClick('year2')}
          className={`flex-1 p-3 font-semibold border-2 ${activeYear === 'year2' 
            ? 'bg-gray-200 border-gray-500' 
            : 'bg-white border-gray-200 hover:bg-gray-50'}`}
        >
          Year 2: 20% weighted
        </button>
        <button 
          onClick={() => handleYearClick('year3')}
          className={`flex-1 p-3 font-semibold border-2 ${activeYear === 'year3' 
            ? 'bg-yellow-300 border-black' 
            : 'bg-white border-gray-200 hover:bg-gray-50'}`}
        >
          Year 3: 80% weighted
        </button>
      </div>
      
      <div className="mb-6">
        <h2 className="text-xl font-bold">{timelineData[activeYear].title}</h2>
        <p>{timelineData[activeYear].description}</p>
      </div>
      
      {/* Legend */}
      <div className="flex space-x-6 mb-6 text-sm">
        <div className="flex items-center">
          <div className="w-4 h-4 bg-indigo-200 border border-indigo-400 mr-2"></div>
          <span>Project/Activity</span>
        </div>
        <div className="flex items-center">
          <div className="w-4 h-4 bg-yellow-400 border border-yellow-600 mr-2"></div>
          <span>Formative Feedback</span>
        </div>
        <div className="flex items-center">
          <div className="w-4 h-4 bg-red-500 border border-red-700 mr-2"></div>
          <span>Summative Assessment</span>
        </div>
        <div className="flex items-center">
          <div className="w-4 h-4 bg-blue-100 border border-blue-300 mr-2"></div>
          <span>Break/Enrichment</span>
        </div>
      </div>
      
      {/* Active detail panel */}
      {activeDetail && timelineData[activeYear].items.find(item => item.id === activeDetail) && (
        <div className="mb-6 bg-blue-50 p-4 rounded border border-blue-200">
          <div className="flex justify-between">
            <h3 className="font-bold text-lg">
              {timelineData[activeYear].items.find(item => item.id === activeDetail).name}
            </h3>
            <button 
              onClick={() => setActiveDetail(null)}
              className="text-gray-500 hover:text-gray-700"
            >
              ✕
            </button>
          </div>
          <p className="my-2">
            {timelineData[activeYear].items.find(item => item.id === activeDetail).details}
          </p>
          <a 
            href={timelineData[activeYear].items.find(item => item.id === activeDetail).link} 
            target="_blank" 
            rel="noopener noreferrer"
            className="inline-block mt-2 bg-blue-600 text-white py-1 px-3 rounded hover:bg-blue-700"
          >
            View Assessment Resources
          </a>
        </div>
      )}
      
      {/* Timeline visualization */}
      <div className="border rounded-lg p-4 bg-gray-50">
        {renderTeachingBlocks()}
        {renderWeekMarkers()}
        <div className="relative">
          {renderTimelineItems()}
        </div>
      </div>
      
      <blockquote className="border-l-4 border-yellow-400 bg-gray-50 p-4 italic my-6">
        "Commitment to practice is the key to progress, and through failure, we often uncover the most valuable lessons that teach us resilience, and gain insights that lead to deeper understanding, growth and mastery. Use this time well."
        <div className="mt-2 text-sm not-italic">Staff member or Fashion Designer quote</div>
      </blockquote>

      <div className="mt-6 text-center text-gray-600 text-sm">
        <p>Kingston School of Art - BA (Hons) Fashion Program – Learning Outcomes, Feedback and Assessment KnowledgeBase</p>
        <p>© 2025 Kingston University</p>
      </div>
    </div>
  );
};

export default FashionProgramTimeline;
